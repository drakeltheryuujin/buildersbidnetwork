<div class="subscriptions_page payments_page checkout row">
  <div class="span4 ">
    <div class="credits_nav">
      <h1>Credits</h1>
      <ul>
        <li>
          <%= link_to "Buy Credits", credits_path %>
        </li>
        <li>
          <%= link_to "Buy a Subscription", subscriptions_path %>
        </li>
      </ul>
    </div>
  </div>
  <div class="row span12">
    <h1>Checkout</h1>

    <table>
      <tr>
        <th>Item</th>
        <th>Quantity</th>
        <th>Unit Price</th>
        <th>Total</th>
      </tr>

      <tr>
        <td>
          Site Subscription - 
          <% if true %>
            Monthly
          <% else %>
            Yearly
          <% end %>
        </td>
        <td>
          1
        </td>
        <td>
          unit price
        </td>
        <td>
          total
        </td>
      </tr>

      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>

      <tr>
        <td>Total</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>
          <%= number_to_currency @subscription.subscription_adjustments.first.amount %>
        </td>
      </tr>

    </table>

    <h1>Enter Payment Information</h1>

    <div class="row span8 payment_info">
      <div class="cards">
        <%= image_tag '/images/cc_icons/visa.png' %>
        <%= image_tag '/images/cc_icons/mastercard.png' %>
        <%= image_tag '/images/cc_icons/amex.png' %>
        <%= image_tag '/images/cc_icons/discover.png' %>
      </div>
      <%= form_for @subscription, :url => subscriptions_path, :method => :post do |f| %>
        <%= f.hidden_field :valid_until %>
        <% if @subscription.errors.any? %>
          <div class="alert-message block-message error">
            <strong><%= pluralize(@subscription.errors.count, "error") %> prohibited this purchase from being completed:</strong>
      
            <ul>
            <% @subscription.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
            </ul>
          </div>
        <% end %>
        <% if @subscription.subscription_adjustments.first.errors.any? %>
          <div class="alert-message block-message error">
            <strong><%= pluralize(@subscription.subscription_adjustments.first.errors.count, "error") %> prohibited this purchase from being completed:</strong>
      
            <ul>
            <% @subscription.subscription_adjustments.first.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
            </ul>
          </div>
        <% end %>

        <%= f.fields_for :subscription_adjustments do |payment_fields| %>
          <%= payment_fields.hidden_field :amount %>
          <%= payment_fields.hidden_field :adjustment_type, :value => payment_fields.object.type %>
          <div class="row">
            <%= payment_fields.label :card_type, "Type", :class => "span2 " %>
            <%= payment_fields.select :card_type, [["Visa", "visa"], ["MasterCard", "master"], ["Discover", "discover"], ["American Express", "american_express"]], {}, :class => "span6 alpha" %>
          </div>
          <div class="row">
            <label class="span2">Name</label>
            <%= payment_fields.text_field :first_name, :placeholder => "First Name", :class => "span6 alpha" %>
          </div>
          <div class="row">
            <label class="span2">&nbsp;</label>
            <%= payment_fields.text_field :last_name, :placeholder => "Last Name", :class => "span6 alpha" %>
          </div>
          <div class="row">
            <%= payment_fields.label :card_number, :class => "span2 " %>
            <%= payment_fields.text_field :card_number,  :placeholder => "Card Number", :class => "span6 alpha" %>
          </div>
          <div class="row">
            <%= payment_fields.label :card_verification, "Security Code", :class => "span2 " %>
            <%= payment_fields.text_field :card_verification, :size => 4, :placeholder => "CCV", :class => "span2 alpha" %>
            <%= payment_fields.label :card_billing_zip, "Postal Code", :class => "span2 " %>
            <%= payment_fields.text_field :card_billing_zip, :size => 6, :placeholder => "Zip", :class => "span2 alpha" %>
          </div>
          <div class="row">
            <%= payment_fields.label :card_expires_on, "Expires", :class => "span2 " %>
            <%= payment_fields.date_select :card_expires_on, {:discard_day => true, :start_year => Date.today.year, :end_year => (Date.today.year+10), :add_month_numbers => true}, :class => "span3 alpha " %>
          </div>
        <% end %>
        <p class="row span8 text_align_right"><%= f.submit "Submit Payment", :class => 'btn large primary' %></p>
      <% end %>
    </div>
  </div>
</div> <!-- /.credits_page -->
